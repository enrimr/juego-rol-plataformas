<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MONSTER JUMP - Game Boy Classic Demo</title>
    <style>
        /* ============================================
           ESTILOS GENERALES Y PALETA GAME BOY
           ============================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0f380f;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Courier New', monospace;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        /* Colores Game Boy Classic */
        :root {
            --gb-darkest: #0f380f;
            --gb-dark: #306230;
            --gb-light: #8bac0f;
            --gb-lightest: #9bbc0f;
        }

        #gameContainer {
            background: var(--gb-lightest);
            border: 8px solid var(--gb-darkest);
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.8);
            position: relative;
        }

        #gameCanvas {
            display: block;
            width: 640px;
            height: 576px;
            image-rendering: pixelated;
            background: var(--gb-lightest);
        }

        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gb-lightest);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: var(--gb-darkest);
            font-size: 24px;
            z-index: 10;
        }

        #startScreen h1 {
            font-size: 32px;
            margin-bottom: 20px;
            text-shadow: 2px 2px var(--gb-dark);
        }

        #startScreen p {
            margin: 10px 0;
            font-size: 16px;
        }

        .blink {
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        #instructions {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: rgba(15, 56, 15, 0.8);
            color: var(--gb-lightest);
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
            max-width: 200px;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="160" height="144"></canvas>
        <div id="startScreen">
            <h1>MONSTER JUMP</h1>
            <p>Un juego híbrido de</p>
            <p>Plataformas y RPG</p>
            <br>
            <p class="blink">PRESIONA ESPACIO</p>
            <br>
            <p style="font-size: 12px;">Controles:</p>
            <p style="font-size: 10px;">← → : Mover | ESPACIO: Saltar</p>
            <p style="font-size: 10px;">En combate: 1-4 para acciones</p>
        </div>
        <div id="instructions">
            <strong>Mecánica especial:</strong><br>
            Salta sobre enemigos débiles para eliminarlos.<br>
            Los enemigos fuertes iniciarán combate.
        </div>
    </div>

    <script>
        /* ============================================
           MOTOR DEL JUEGO - MONSTER JUMP
           Game Boy Classic Style (160x144)
           ============================================ */

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startScreen = document.getElementById('startScreen');

        // Paleta de colores Game Boy
        const GB_COLORS = {
            darkest: '#0f380f',
            dark: '#306230',
            light: '#8bac0f',
            lightest: '#9bbc0f'
        };

        // ============================================
        // CLASES DEL JUEGO
        // ============================================

        // Clase Player - Representa al jugador
        class Player {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.width = 8;
                this.height = 12;
                this.vx = 0;
                this.vy = 0;
                this.speed = 1.5;
                this.jumpPower = -4;
                this.gravity = 0.3;
                this.onGround = false;
                this.jumping = false;
                
                // Stats del jugador
                this.level = 1;
                this.maxHp = 20;
                this.hp = 20;
                this.maxEnergy = 10;
                this.energy = 10;
                this.xp = 0;
                this.xpToNextLevel = 10;
                this.attack = 5;
                this.defense = 2;
            }

            update(keys, platforms) {
                // Movimiento horizontal
                if (keys['ArrowLeft'] || keys['KeyA']) {
                    this.vx = -this.speed;
                } else if (keys['ArrowRight'] || keys['KeyD']) {
                    this.vx = this.speed;
                } else {
                    this.vx = 0;
                }

                // Salto
                if ((keys['Space'] || keys['ArrowUp'] || keys['KeyW']) && this.onGround && !this.jumping) {
                    this.vy = this.jumpPower;
                    this.onGround = false;
                    this.jumping = true;
                }

                // Aplicar gravedad
                this.vy += this.gravity;
                
                // Actualizar posición
                this.x += this.vx;
                this.y += this.vy;

                // Colisión con el suelo
                this.onGround = false;
                for (let platform of platforms) {
                    if (this.collidesWith(platform)) {
                        if (this.vy > 0 && this.y + this.height <= platform.y + 10) {
                            this.y = platform.y - this.height;
                            this.vy = 0;
                            this.onGround = true;
                            this.jumping = false;
                        }
                    }
                }

                // Límites del mundo
                if (this.x < 0) this.x = 0;
                if (this.x > 160 - this.width) this.x = 160 - this.width;
                if (this.y > 144) {
                    this.y = 0;
                }
            }

            collidesWith(obj) {
                return this.x < obj.x + obj.width &&
                       this.x + this.width > obj.x &&
                       this.y < obj.y + obj.height &&
                       this.y + this.height > obj.y;
            }

            collidesFromAbove(enemy) {
                // Detectar si el jugador cae sobre el enemigo
                return this.vy > 0 && 
                       this.y + this.height <= enemy.y + enemy.height / 2 &&
                       this.x < enemy.x + enemy.width &&
                       this.x + this.width > enemy.x;
            }

            gainXP(amount) {
                this.xp += amount;
                if (this.xp >= this.xpToNextLevel) {
                    this.levelUp();
                }
            }

            levelUp() {
                this.level++;
                this.xp = 0;
                this.xpToNextLevel = Math.floor(this.xpToNextLevel * 1.5);
                this.maxHp += 5;
                this.hp = this.maxHp;
                this.maxEnergy += 2;
                this.energy = this.maxEnergy;
                this.attack += 2;
                this.defense += 1;
            }

            heal(amount) {
                this.hp = Math.min(this.hp + amount, this.maxHp);
            }

            takeDamage(amount) {
                const damage = Math.max(1, amount - this.defense);
                this.hp -= damage;
                return damage;
            }

            draw(ctx, cameraX) {
                ctx.fillStyle = GB_COLORS.darkest;
                ctx.fillRect(this.x - cameraX, this.y, this.width, this.height);
                // Ojos
                ctx.fillStyle = GB_COLORS.lightest;
                ctx.fillRect(this.x - cameraX + 2, this.y + 3, 2, 2);
                ctx.fillRect(this.x - cameraX + 5, this.y + 3, 2, 2);
            }
        }

        // Clase Enemy - Representa a los enemigos
        class Enemy {
            constructor(x, y, type) {
                this.x = x;
                this.y = y;
                this.width = 10;
                this.height = 10;
                this.type = type;
                this.alive = true;
                this.defeated = false;
                
                // Stats según tipo
                switch(type) {
                    case 'slime':
                        this.level = 1;
                        this.maxHp = 8;
                        this.hp = 8;
                        this.attack = 3;
                        this.defense = 1;
                        this.xpReward = 5;
                        this.color = GB_COLORS.light;
                        break;
                    case 'beetle':
                        this.level = 3;
                        this.maxHp = 15;
                        this.hp = 15;
                        this.attack = 6;
                        this.defense = 3;
                        this.xpReward = 12;
                        this.color = GB_COLORS.dark;
                        break;
                    case 'warlord':
                        this.level = 5;
                        this.maxHp = 25;
                        this.hp = 25;
                        this.attack = 10;
                        this.defense = 5;
                        this.xpReward = 25;
                        this.color = GB_COLORS.darkest;
                        break;
                }
            }

            takeDamage(amount) {
                const damage = Math.max(1, amount - this.defense);
                this.hp -= damage;
                if (this.hp <= 0) {
                    this.defeated = true;
                    this.alive = false;
                }
                return damage;
            }

            draw(ctx, cameraX) {
                if (!this.alive) return;
                
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x - cameraX, this.y, this.width, this.height);
                
                // Ojos enemigos
                ctx.fillStyle = GB_COLORS.lightest;
                ctx.fillRect(this.x - cameraX + 2, this.y + 3, 2, 2);
                ctx.fillRect(this.x - cameraX + 6, this.y + 3, 2, 2);
                
                // Indicador de nivel
                ctx.fillStyle = GB_COLORS.darkest;
                ctx.font = '6px monospace';
                ctx.fillText(`L${this.level}`, this.x - cameraX, this.y - 2);
            }
        }

        // Clase Platform - Plataformas del juego
        class Platform {
            constructor(x, y, width, height) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
            }

            draw(ctx, cameraX) {
                ctx.fillStyle = GB_COLORS.dark;
                ctx.fillRect(this.x - cameraX, this.y, this.width, this.height);
            }
        }

        // ============================================
        // SISTEMA DE COMBATE
        // ============================================
        class CombatSystem {
            constructor(player, enemy) {
                this.player = player;
                this.enemy = enemy;
                this.turn = 'player';
                this.message = 'Tu turno! Elige acción:';
                this.selectedAction = 0;
                this.actions = ['ATACAR', 'HABILIDAD', 'DEFENDER', 'HUIR'];
                this.defending = false;
                this.active = true;
                this.result = null;
                this.messageTimer = 0;
            }

            handleInput(key) {
                if (this.turn !== 'player' || this.messageTimer > 0) return;

                if (key === 'Digit1' || key === 'Digit2' || key === 'Digit3' || key === 'Digit4') {
                    const action = parseInt(key.charAt(5)) - 1;
                    this.executePlayerAction(action);
                }
            }

            executePlayerAction(action) {
                this.defending = false;
                
                switch(action) {
                    case 0: // ATACAR
                        const damage = Math.floor(this.player.attack * (0.8 + Math.random() * 0.4));
                        const dealt = this.enemy.takeDamage(damage);
                        this.message = `Atacaste! Daño: ${dealt}`;
                        break;
                        
                    case 1: // HABILIDAD
                        if (this.player.energy >= 3) {
                            const skillDamage = Math.floor(this.player.attack * 1.5);
                            const dealt2 = this.enemy.takeDamage(skillDamage);
                            this.player.energy -= 3;
                            this.message = `Habilidad! Daño: ${dealt2}`;
                        } else {
                            this.message = 'No tienes energía!';
                            return;
                        }
                        break;
                        
                    case 2: // DEFENDER
                        this.defending = true;
                        this.message = 'Te defiendes...';
                        break;
                        
                    case 3: // HUIR
                        if (Math.random() > 0.5) {
                            this.message = 'Huiste del combate!';
                            this.result = 'flee';
                            this.active = false;
                            return;
                        } else {
                            this.message = 'No pudiste huir!';
                        }
                        break;
                }
                
                this.messageTimer = 60;
                
                // Verificar si el enemigo fue derrotado
                if (this.enemy.defeated) {
                    this.result = 'win';
                    this.active = false;
                    return;
                }
                
                // Turno del enemigo
                this.turn = 'enemy';
            }

            update() {
                if (this.messageTimer > 0) {
                    this.messageTimer--;
                    if (this.messageTimer === 0 && this.turn === 'enemy') {
                        this.executeEnemyAction();
                    }
                }
            }

            executeEnemyAction() {
                const enemyDamage = Math.floor(this.enemy.attack * (0.8 + Math.random() * 0.4));
                const receivedDamage = this.defending ? 
                    Math.floor(enemyDamage * 0.5) : 
                    this.player.takeDamage(enemyDamage);
                
                this.message = `${this.enemy.type} ataca! Daño: ${receivedDamage}`;
                this.messageTimer = 60;
                
                if (this.player.hp <= 0) {
                    this.result = 'lose';
                    this.active = false;
                    return;
                }
                
                this.turn = 'player';
                setTimeout(() => {
                    this.message = 'Tu turno! Elige acción:';
                }, 1000);
            }

            draw(ctx) {
                // Fondo de combate
                ctx.fillStyle = GB_COLORS.lightest;
                ctx.fillRect(0, 0, 160, 144);
                
                // Título
                ctx.fillStyle = GB_COLORS.darkest;
                ctx.font = '8px monospace';
                ctx.fillText('COMBATE!', 60, 10);
                
                // Enemigo
                ctx.fillStyle = this.enemy.color;
                ctx.fillRect(110, 30, 20, 20);
                ctx.fillStyle = GB_COLORS.lightest;
                ctx.fillRect(114, 36, 4, 4);
                ctx.fillRect(122, 36, 4, 4);
                
                // Stats enemigo
                ctx.fillStyle = GB_COLORS.darkest;
                ctx.font = '6px monospace';
                ctx.fillText(`${this.enemy.type.toUpperCase()} Lv${this.enemy.level}`, 90, 60);
                ctx.fillText(`HP: ${this.enemy.hp}/${this.enemy.maxHp}`, 90, 68);
                
                // Barra de vida enemigo
                const enemyHpPercent = this.enemy.hp / this.enemy.maxHp;
                ctx.fillStyle = GB_COLORS.dark;
                ctx.fillRect(90, 70, 60, 4);
                ctx.fillStyle = GB_COLORS.light;
                ctx.fillRect(90, 70, 60 * enemyHpPercent, 4);
                
                // Jugador
                ctx.fillStyle = GB_COLORS.darkest;
                ctx.fillRect(20, 80, 16, 24);
                ctx.fillStyle = GB_COLORS.lightest;
                ctx.fillRect(24, 86, 4, 4);
                ctx.fillRect(30, 86, 4, 4);
                
                // Stats jugador
                ctx.fillStyle = GB_COLORS.darkest;
                ctx.font = '6px monospace';
                ctx.fillText(`TU Lv${this.player.level}`, 10, 110);
                ctx.fillText(`HP: ${this.player.hp}/${this.player.maxHp}`, 10, 118);
                ctx.fillText(`EN: ${this.player.energy}/${this.player.maxEnergy}`, 10, 126);
                
                // Barras del jugador
                const playerHpPercent = this.player.hp / this.player.maxHp;
                ctx.fillStyle = GB_COLORS.dark;
                ctx.fillRect(50, 108, 40, 4);
                ctx.fillStyle = GB_COLORS.light;
                ctx.fillRect(50, 108, 40 * playerHpPercent, 4);
                
                const playerEpPercent = this.player.energy / this.player.maxEnergy;
                ctx.fillStyle = GB_COLORS.dark;
                ctx.fillRect(50, 116, 40, 4);
                ctx.fillStyle = GB_COLORS.lightest;
                ctx.fillRect(50, 116, 40 * playerEpPercent, 4);
                
                // Mensaje
                ctx.fillStyle = GB_COLORS.dark;
                ctx.fillRect(5, 130, 150, 12);
                ctx.fillStyle = GB_COLORS.lightest;
                ctx.font = '6px monospace';
                ctx.fillText(this.message, 8, 138);
                
                // Acciones
                if (this.turn === 'player' && this.messageTimer === 0) {
                    ctx.fillStyle = GB_COLORS.darkest;
                    ctx.font = '6px monospace';
                    for (let i = 0; i < this.actions.length; i++) {
                        ctx.fillText(`${i+1}.${this.actions[i]}`, 100, 85 + i * 8);
                    }
                }
            }
        }

        // ============================================
        // MOTOR DEL JUEGO
        // ============================================
        
        class Game {
            constructor() {
                this.player = new Player(20, 100);
                this.platforms = [];
                this.enemies = [];
                this.combat = null;
                this.keys = {};
                this.cameraX = 0;
                this.gameStarted = false;
                this.levelUpMessage = 0;
                
                this.initLevel();
                this.setupInput();
            }

            initLevel() {
                // Plataformas
                this.platforms = [
                    new Platform(0, 135, 300, 10),      // Suelo principal
                    new Platform(50, 110, 40, 5),       // Plataforma 1
                    new Platform(120, 95, 50, 5),       // Plataforma 2
                    new Platform(200, 80, 40, 5),       // Plataforma 3
                ];
                
                // Enemigos
                this.enemies = [
                    new Enemy(80, 125, 'slime'),
                    new Enemy(140, 85, 'beetle'),
                    new Enemy(220, 70, 'warlord'),
                    new Enemy(180, 125, 'slime'),
                    new Enemy(250, 125, 'beetle'),
                ];
            }

            setupInput() {
                document.addEventListener('keydown', (e) => {
                    this.keys[e.code] = true;
                    
                    if (!this.gameStarted && e.code === 'Space') {
                        this.gameStarted = true;
                        startScreen.style.display = 'none';
                    }
                    
                    if (this.combat && this.combat.active) {
                        this.combat.handleInput(e.code);
                    }
                });
                
                document.addEventListener('keyup', (e) => {
                    this.keys[e.code] = false;
                });
            }

            update() {
                if (!this.gameStarted) return;
                
                if (this.combat) {
                    // Modo combate
                    this.combat.update();
                    
                    if (!this.combat.active) {
                        if (this.combat.result === 'win') {
                            this.player.gainXP(this.combat.enemy.xpReward);
                            this.levelUpMessage = 120;
                        } else if (this.combat.result === 'lose') {
                            // Game Over
                            this.gameStarted = false;
                            startScreen.innerHTML = '<h1>GAME OVER</h1><p class="blink">PRESIONA ESPACIO</p>';
                            startScreen.style.display = 'flex';
                            this.player = new Player(20, 100);
                            this.initLevel();
                        }
                        this.combat = null;
                    }
                } else {
                    // Modo plataformas
                    this.player.update(this.keys, this.platforms);
                    
                    // Cámara sigue al jugador
                    this.cameraX = Math.max(0, Math.min(this.player.x - 80, 300 - 160));
                    
                    // Colisión con enemigos
                    for (let enemy of this.enemies) {
                        if (!enemy.alive) continue;
                        
                        if (this.player.collidesWith(enemy)) {
                            if (this.player.collidesFromAbove(enemy)) {
                                // Salto sobre enemigo
                                if (enemy.level < this.player.level) {
                                    // Muerte instantánea
                                    enemy.alive = false;
                                    enemy.defeated = true;
                                    this.player.gainXP(enemy.xpReward);
                                    this.player.vy = -3; // Rebote
                                    this.levelUpMessage = 120;
                                } else {
                                    // Iniciar combate
                                    this.combat = new CombatSystem(this.player, enemy);
                                }
                            } else {
                                // Colisión lateral - combate automático
                                this.combat = new CombatSystem(this.player, enemy);
                            }
                        }
                    }
                    
                    if (this.levelUpMessage > 0) {
                        this.levelUpMessage--;
                    }
                }
            }

            draw() {
                // Limpiar pantalla
                ctx.fillStyle = GB_COLORS.lightest;
                ctx.fillRect(0, 0, 160, 144);
                
                if (this.combat) {
                    // Dibujar combate
                    this.combat.draw(ctx);
                } else {
                    // Dibujar mundo
                    for (let platform of this.platforms) {
                        platform.draw(ctx, this.cameraX);
                    }
                    
                    for (let enemy of this.enemies) {
                        enemy.draw(ctx, this.cameraX);
                    }
                    
                    this.player.draw(ctx, this.cameraX);
                    
                    // HUD
                    this.drawHUD();
                }
            }

            drawHUD() {
                // Fondo HUD
                ctx.fillStyle = GB_COLORS.dark;
                ctx.fillRect(0, 0, 160, 12);
                
                // Stats del jugador
                ctx.fillStyle = GB_COLORS.lightest;
                ctx.font = '6px monospace';
                ctx.fillText(`Lv${this.player.level}`, 2, 8);
                ctx.fillText(`HP:${this.player.hp}/${this.player.maxHp}`, 20, 8);
                ctx.fillText(`EN:${this.player.energy}/${this.player.maxEnergy}`, 60, 8);
                
                // Barra de XP
                const xpPercent = this.player.xp / this.player.xpToNextLevel;
                ctx.fillStyle = GB_COLORS.darkest;
                ctx.fillRect(100, 4, 58, 4);
                ctx.fillStyle = GB_COLORS.light;
                ctx.fillRect(100, 4, 58 * xpPercent, 4);
                ctx.fillStyle = GB_COLORS.lightest;
                ctx.font = '5px monospace';
                ctx.fillText('XP', 100, 3);
                
                // Mensaje de subida de nivel
                if (this.levelUpMessage > 0) {
                    ctx.fillStyle = GB_COLORS.darkest;
                    ctx.font = '8px monospace';
                    ctx.fillText('LEVEL UP!', 55, 70);
                }
            }
        }

        // ============================================
        // INICIALIZAR JUEGO
        // ============================================
        
        const game = new Game();

        function gameLoop() {
            game.update();
            game.draw();
            requestAnimationFrame(gameLoop);
        }

        gameLoop();

    </script>
</body>
</html>
